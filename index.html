<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quiz App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f9fa;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .container {
      width: 90%;
      max-width: 600px;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      text-align: center;
    }
    h1, h2, h3 {
      color: #333;
    }
    .button {
      display: block;
      width: 100%;
      margin: 8px 0;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background: #007bff;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .button:hover {
      background: #0056b3;
    }
    .back {
      background: #6c757d;
    }
    .back:hover {
      background: #565e64;
    }
    .correct {
      background: #28a745 !important;
    }
    .wrong {
      background: #dc3545 !important;
    }
    .explanation {
      margin-top: 15px;
      font-size: 14px;
      color: #555;
    }
  </style>
</head>
<body>
  <div class="container" id="app">
    <h1>Quiz App</h1>
    <p>Loading subjects...</p>
  </div>

  <script>
    const app = document.getElementById("app");
    // 🔹 Master file is now local (same folder as index.html)
    const masterFile = "subjects.json";

    let history = [];

    async function loadJSON(url) {
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error("HTTP " + res.status);
        return await res.json();
      } catch (e) {
        console.error("Error loading:", url, e);
        app.innerHTML = `<p style="color:red;">Failed to load ${url}</p>`;
        return null;
      }
    }

    function renderButtons(title, items, onClick, showBack = false) {
      app.innerHTML = `<h2>${title}</h2>`;
      items.forEach(item => {
        const btn = document.createElement("button");
        btn.className = "button";
        btn.textContent = item.name || "Unnamed";
        btn.onclick = () => onClick(item);
        app.appendChild(btn);
      });
      if (showBack) {
        const backBtn = document.createElement("button");
        backBtn.className = "button back";
        backBtn.textContent = "⬅ Back";
        backBtn.onclick = goBack;
        app.appendChild(backBtn);
      }
    }

    function goBack() {
      const last = history.pop();
      if (last) last();
    }

    async function startApp() {
      const subjects = await loadJSON(masterFile);
      if (!subjects) return;
      renderButtons("Select a Subject", subjects, subject => {
        history.push(() => startApp());
        loadSubject(subject.file);
      });
    }

    async function loadSubject(url) {
      const topics = await loadJSON(url);
      if (!topics) return;
      renderButtons("Select a Topic", topics, topic => {
        history.push(() => loadSubject(url));
        loadTopic(topic.file);
      }, true);
    }

    async function loadTopic(url) {
      const quizzes = await loadJSON(url);
      if (!quizzes) return;
      renderButtons("Select a Quiz", quizzes, quiz => {
        history.push(() => loadTopic(url));
        loadQuiz(quiz.file);
      }, true);
    }

    async function loadQuiz(url) {
      const questions = await loadJSON(url);
      if (!questions) return;
      let index = 0;

      function showQuestion() {
        if (index >= questions.length) {
          app.innerHTML = "<h2>🎉 Quiz Completed!</h2>";
          const backBtn = document.createElement("button");
          backBtn.className = "button back";
          backBtn.textContent = "⬅ Back to Quizzes";
          backBtn.onclick = goBack;
          app.appendChild(backBtn);
          return;
        }

        const q = questions[index];
        app.innerHTML = `<h3>Q${index + 1}: ${q.question}</h3>`;
        q.options.forEach(opt => {
          const btn = document.createElement("button");
          btn.className = "button";
          btn.textContent = opt;
          btn.onclick = () => {
            if (opt === q.answer) {
              btn.classList.add("correct");
              showExplanation("✅ Correct! " + (q.explanation || ""));
            } else {
              btn.classList.add("wrong");
              showExplanation("❌ Wrong. " + (q.explanation || ""));
            }
          };
          app.appendChild(btn);
        });

        const backBtn = document.createElement("button");
        backBtn.className = "button back";
        backBtn.textContent = "⬅ Back to Quizzes";
        backBtn.onclick = goBack;
        app.appendChild(backBtn);
      }

      function showExplanation(text) {
        const div = document.createElement("div");
        div.className = "explanation";
        div.textContent = text;
        app.appendChild(div);

        const nextBtn = document.createElement("button");
        nextBtn.className = "button";
        nextBtn.textContent = "Next Question ➡";
        nextBtn.onclick = () => {
          index++;
          showQuestion();
        };
        app.appendChild(nextBtn);
      }

      showQuestion();
    }

    startApp();
  </script>
</body>
</html>
