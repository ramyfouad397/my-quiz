<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quiz App</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .container { max-width: 700px; margin: auto; }
    button { margin: 5px; padding: 10px 15px; cursor: pointer; }
    .question { font-weight: bold; margin-top: 20px; }
    .options button { display: block; margin: 5px 0; width: 100%; }
    .feedback { margin-top: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Quiz App</h1>
    <div id="app">Loading subjects...</div>
  </div>

  <script>
    const subjectsUrl = "https://gist.githubusercontent.com/ramyfouad397/7d4d72839a2a50146c671cf43328024d/raw/72014a8078e02da71415375ffb7db3bdd676df8b/subjects.txt";

    let subjectsData = null;
    let currentQuiz = null;
    let currentQuestion = 0;

    async function loadJSON(url) {
      try {
        const res = await fetch(url);
        const text = await res.text();
        return JSON.parse(text);
      } catch (err) {
        console.error("Error loading JSON:", err);
        document.getElementById("app").innerHTML = "‚ùå Failed to load file: " + url;
      }
    }

    async function init() {
      subjectsData = await loadJSON(subjectsUrl);
      if (subjectsData) {
        showSubjects(subjectsData.subjects);
      }
    }

    function showSubjects(subjects) {
      const app = document.getElementById("app");
      app.innerHTML = "<h2>Select Subject</h2>";
      subjects.forEach(subject => {
        const btn = document.createElement("button");
        btn.textContent = subject.name;
        btn.onclick = () => showTopics(subject);
        app.appendChild(btn);
      });
    }

    async function showTopics(subject) {
      const topicsData = await loadJSON(subject.url);
      const app = document.getElementById("app");
      app.innerHTML = `<h2>${subject.name}: Select Topic</h2>`;
      topicsData.topics.forEach(topic => {
        const btn = document.createElement("button");
        btn.textContent = topic.name;
        btn.onclick = () => showQuizzes(topic);
        app.appendChild(btn);
      });
    }

    async function showQuizzes(topic) {
      const quizzesData = await loadJSON(topic.url);
      const app = document.getElementById("app");
      app.innerHTML = `<h2>${topic.name}: Select Quiz</h2>`;
      quizzesData.quizzes.forEach(quiz => {
        const btn = document.createElement("button");
        btn.textContent = quiz.name;
        btn.onclick = () => startQuiz(quiz.url);
        app.appendChild(btn);
      });
    }

    async function startQuiz(url) {
      currentQuiz = await loadJSON(url);
      currentQuestion = 0;
      showQuestion();
    }

    function showQuestion() {
      const app = document.getElementById("app");
      const q = currentQuiz.questions[currentQuestion];
      app.innerHTML = `<div class="question">${q.question}</div>`;
      const optionsDiv = document.createElement("div");
      optionsDiv.className = "options";

      q.options.forEach(opt => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.onclick = () => checkAnswer(opt, q);
        optionsDiv.appendChild(btn);
      });

      app.appendChild(optionsDiv);
      const feedback = document.createElement("div");
      feedback.className = "feedback";
      app.appendChild(feedback);
    }

    function checkAnswer(selected, q) {
      const feedback = document.querySelector(".feedback");
      if (selected === q.answer) {
        feedback.innerHTML = `<span style="color:green;">‚úî Correct!</span><br>${q.explanation}`;
      } else {
        feedback.innerHTML = `<span style="color:red;">‚úò Wrong.</span><br>Correct: <b>${q.answer}</b><br>${q.explanation}`;
      }
      setTimeout(() => {
        currentQuestion++;
        if (currentQuestion < currentQuiz.questions.length) {
          showQuestion();
        } else {
          document.getElementById("app").innerHTML = "<h2>üéâ Quiz Completed!</h2>";
        }
      }, 2500);
    }

    init();
  </script>
</body>
</html>
